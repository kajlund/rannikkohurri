var angular=angular||null;!function(e){"use strict";var t={radius:40,lines:7,length:0,width:30,speed:1.7,corners:1,trail:100,color:"#333",zIndex:2e9,left:"auto",top:"200px"},o=e.module("app",["ui.router","ngAnimate","ngCookies","infinite-scroll","mgcrea.ngStrap"]);o.config(["$stateProvider","$urlRouterProvider","$httpProvider","$modalProvider",function(t,o,r,n){r.defaults.headers.common["X-Parse-Application-Id"]="HZAMesseJ6CDe1K5dFLfxbGbMYD6aV3lBaEp3Ib1",r.defaults.headers.common["X-Parse-REST-API-Key"]="LZqwu8VIutbaphzVoPW7yf4RxkKQAMbAapwubT5L",e.extend(n.defaults,{animation:"am-fade-and-scale",placement:"center",html:!0}),o.when("/posts","/posts/list"),o.otherwise("home"),t.state("home",{url:"/home",templateUrl:"app/home.html",controller:"HomeController"}).state("posts",{"abstract":!0,url:"/posts",templateUrl:"app/posts/posts.html"}).state("posts.list",{url:"/list",templateUrl:"app/posts/list.html",controller:"postListController"}).state("posts.detail",{url:"/:id",templateUrl:"app/posts/detail.html",controller:"PostDetailController"}).state("links",{url:"/links",templateUrl:"app/links/links.html",controller:"LinksController"}).state("about",{url:"/about",templateUrl:"app/about.html",controller:"AboutController"}).state("books",{url:"/books",templateUrl:"app/books/list.html",controller:"bookListController"}).state("bookedit",{url:"/books:bookId",templateUrl:"app/books/edit.html",controller:"bookEditController"}).state("movies",{url:"/movies",templateUrl:"app/movies/list.html",controller:"movieListController"}).state("movieedit",{url:"/movies:movieId",templateUrl:"app/movies/edit.html",controller:"movieEditController"}).state("events",{url:"/events",templateUrl:"app/events/list.html",controller:"EventListController"}).state("eventedit",{url:"/events:eventId",templateUrl:"app/events/edit.html",controller:"eventEditController"}).state("cheats",{url:"/cheats",templateUrl:"app/cheats/list.html",controller:"cheatsListController"}).state("cheatsedit",{url:"/cheats/:cacheId",templateUrl:"app/cheats/edit.html",controller:"cheatsEditController"})}]),o.run(["$rootScope","$state","$stateParams","$log","$window",function(e,o,r,n,s){e.busy=function(o){o?(e.spinner||(e.spinner=new s.Spinner(t)),e.spinner.spin(s.document.documentElement)):e.spinner&&e.spinner.stop()},s.toastr.options.timeOut=2e3,s.toastr.options.positionClass="toast-bottom-right",s.marked.setOptions({gfm:!0}),e.$state=o,e.$stateParams=r,n.info("App Loaded")}]),o.directive("aDisabled",function(){return{restrict:"A",priority:-99999,link:function(e,t,o){e.$watch(o.aDisabled,function(r,n){r?t.unbind("click"):n&&t.bind("click",function(){e.$apply(o.ngClick)})})}}})}(angular),function(e){"use strict";e.module("app").controller("AboutController",["$scope","$rootScope","$location","$log",function(){}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e,t){"use strict";e.module("app").controller("headerController",["$scope","$rootScope","$location","$log","$modal","SessionService",function(e,o,r,n,s,a){var i=s({scope:e,template:"app/signon.html",show:!1});e.session=a,e.user={name:"",pwd:""},e.getClass=function(e){var t="";return r.path().substr(0,e.length)===e&&(t="active"),t},e.login=function(){i.hide(),a.signon(e.user.name,e.user.pwd).then(function(){t.info(a.userObj.username+" signed on")},function(e){t.error(e.error)})},e.onSignonClick=function(){i.$promise.then(i.show)},e.onSignoffClick=function(){n.info("Signing off"),a.signoff(),t.warning("User signed off")}}])}(angular,toastr);var angular=angular||null;!function(e){"use strict";e.module("app").controller("HomeController",["$scope","$rootScope","$location","$log","$modal","SessionService",function(e,t,o,r,n,s){e.session=s,s.loggedOn()||(t.busy(!0),r.info("not logged on"),s.autoSignon().then(function(){r.info(e.session),t.busy(!1)},function(e){r.error(e),t.busy(!1)}))}])}(angular),function(e){"use strict";e.module("app").factory("SessionService",["$rootScope","$http","$cookieStore","$log","$q",function(e,t,o,r,n){function s(e){i.userObj=e,i.sessionToken=e.sessionToken,o.put("ParseUser",e)}function a(){i.userObj=null,i.sessionToken="",o.remove("ParseUser")}var i={};return i.sessionToken="",i.userObj=null,i.autoSignon=function(){var e=o.get("ParseUser"),a={headers:{"X-Parse-Application-Id":"HZAMesseJ6CDe1K5dFLfxbGbMYD6aV3lBaEp3Ib1","X-Parse-REST-API-Key":"LZqwu8VIutbaphzVoPW7yf4RxkKQAMbAapwubT5L","X-Parse-Session-Token":e?e.sessionToken:""},method:"GET",url:"https://api.parse.com/1/users/me"},i=n.defer();return e&&e.sessionToken.length>10?t(a).success(function(e){r.info("autoSignon success, data = %o",e),s(e),i.resolve(e)}).error(function(e){i.reject(e.error)}):i.reject("Invalid Cookie"),i.promise},i.loggedOn=function(){return null!==i.userObj},i.signoff=function(){a()},i.signon=function(e,o){var r="?username="+e+"&password="+o,i={method:"GET",url:" https://api.parse.com/1/login"+r};return t(i).then(function(e){return"object"==typeof e.data?(s(e.data),e.data):(a(),n.reject(e.data))},function(e){return a(),n.reject(e.data)})},i}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("bookEditController",["$scope","$rootScope","$state","$log","SessionService","bookDataService",function(e,t,o,r,n,s){e.session=n,e.bookId=t.$stateParams.bookId,e.languages=["swe","eng","fin"],e.genres=["Biography","History","Kids","Misc","Novel","Science","Technology"],"_new"===e.bookId?e.book={authors:"",genre:"",image:"",lang:"",subtitle:"",title:""}:s.getItem(e.bookId).then(function(t){e.book=t.data},function(e){r.error(e),toastr.error(e.error.code+" "+e.error.error),o.go("books")}),e.save=function(){s.updateItem(e.book).then(function(e){r.info("Saved Book %o",e),toastr.success("Book saved"),o.go("books")},function(e){r.error("Error saving Book %o",e),toastr.error(e.error.code+" "+e.error.error),o.go("books")})},e.cancel=function(){r.info("Cancelled Edit"),toastr.warning("Edit cancelled"),o.go("books")}}])}(angular.module("app"));var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("bookListController",["$scope","$rootScope","$state","$log","$modal","SessionService","bookDataService",function(e,t,o,r,n,s,a){function i(){e.fetching||(e.fetching=!0,t.busy(!0),a.getPage(e.order,e.filter,e.currentPage).then(function(o){e.items=e.items.concat(o.data.results),e.totalItems=o.data.count,t.busy(!1),e.fetching=!1},function(o){t.busy(!1),r.error(o),toastr.error(o.error.code+" "+o.error.error),e.fetching=!1}))}var l=null;e.session=s,e.filter="",e.currentPage=1,e.maxSize=10,e.order="title",e.totalItems=0,e.currentItem=null,e.items=[],e.fetching=!1,i(),e.onAddClick=function(){o.go("bookedit",{bookId:"_new"})},e.onEditClick=function(e){o.go("bookedit",{bookId:e.objectId})},e.onDeleteClick=function(t){e.currentItem=t,l=n({scope:e,template:"app/tmplVerify.html",show:!0,title:"Delete Book?",content:"You are about to delete book <em>"+t.title+"</em>"})},e.dlgVerifyCancel=function(){l.hide(),toastr.warning("Delete cancelled")},e.dlgVerifyOK=function(){l.hide(),t.busy(!0),a.deleteItem(e.currentItem).then(function(){r.info("Deleted Book"),toastr.success("Book deleted"),e.items=_.filter(e.items,function(t){return t.objectId!==e.currentItem.objectId}),t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})},e.scroll=function(){e.currentPage+=1,i()}}])}(angular.module("app"));var angular=angular||null;!function(e){"use strict";e.module("app").factory("bookDataService",["$log","$q","$http","SessionService",function(e,t,o,r){var n="https://api.parse.com/1/classes/AudioBook",s={};return s.pageSize=100,s.getItem=function(e){var t={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"/"+e};return o(t)},s.getItems=function(){var e={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"?count=1&limit=1000&order=title"};return o(e)},s.getPage=function(e,t,a){var i=""===t?"":'&where={"'+e+'":{"$gte":"'+t+'"}}',l=(a-1)*s.pageSize,c="?count=1&limit="+s.pageSize+"&skip="+l+"&order="+e+i,u={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+c};return o(u)},s.updateItem=function(e){var t=void 0===e.objectId,s=t?n+"/":n+"/"+e.objectId,a={headers:{"X-Parse-Session-Token":r.sessionToken},method:t?"POST":"PUT",url:s,data:e};return o(a)},s.deleteItem=function(e){var t=n+"/"+e.objectId,s={headers:{"X-Parse-Session-Token":r.sessionToken},method:"DELETE",url:t};return o(s)},s}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("cheatsEditController",["$scope","$rootScope","$state","$log","SessionService","cheatsDataService",function(e,t,o,r,n,s){e.session=n,e.cacheId=t.$stateParams.cacheId,e.cacheTypes=["Tradi","Mystery","Multi","Earth","Letterbox","Event","Lab","Virtual"],"_new"===e.cacheId?e.cache={cacheId:"",cacheType:"",name:"",coords:"",verifiedCoords:!1}:s.getItem(e.cacheId).then(function(t){e.cache=t.data,e.currentType=e.cache.cacheType},function(e){r.error(e),toastr.error(e.error.code+" "+e.error.error),o.go("cheats")}),e.save=function(){s.updateItem(e.cache).then(function(e){r.info("Saved Cache %o",e),toastr.success("Cache saved"),o.go("cheats")},function(e){r.error("Error saving Cache %o",e),toastr.error(e.error.code+" "+e.error.error),o.go("cheats")})},e.cancel=function(){r.info("Cancelled Edit"),toastr.warning("Edit cancelled"),o.go("cheats")}}])}(angular.module("app"));var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("cheatsListController",["$scope","$rootScope","$state","$log","$modal","SessionService","cheatsDataService",function(e,t,o,r,n,s,a){function i(){t.busy(!0),a.getItems().then(function(o){r.info(o),e.items=o.data.results,t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})}var l=null;e.session=s,e.totalItems=0,e.currentItem=null,i(),e.onAddClick=function(){o.go("cheatsedit",{eventId:"_new"})},e.onEditClick=function(e){o.go("cheatsedit",{cacheId:e.objectId})},e.onDeleteClick=function(t){e.currentItem=t,l=n({scope:e,template:"app/tmplVerify.html",show:!0,title:"Delete Cache?",content:"You are about to delete cache <strong>"+t.name+"</strong>"})},e.dlgVerifyCancel=function(){l.hide(),toastr.warning("Delete cancelled")},e.dlgVerifyOK=function(){l.hide(),t.busy(!0),a.deleteItem(e.currentItem).then(function(){r.info("Deleted Cache"),toastr.success("Cache deleted"),e.items=_.filter(e.items,function(t){return t.objectId!==e.currentItem.objectId}),t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})}}])}(angular.module("app"));var angular=angular||null;!function(e){"use strict";e.factory("cheatsDataService",["$log","$q","$http","SessionService",function(e,t,o,r){var n="https://api.parse.com/1/classes/Cheat",s={};return s.getItem=function(e){var t={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"/"+e};return o(t)},s.getItems=function(){var e={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"?count=1&limit=1000&order=name"};return o(e)},s.updateItem=function(e){var t=void 0===e.objectId,s=t?n+"/":n+"/"+e.objectId,a={headers:{"X-Parse-Session-Token":r.sessionToken},method:t?"POST":"PUT",url:s,data:e};return o(a)},s.deleteItem=function(e){var t=n+"/"+e.objectId,s={headers:{"X-Parse-Session-Token":r.sessionToken},method:"DELETE",url:t};return o(s)},s}])}(angular.module("app"));var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.module("app").controller("eventEditController",["$scope","$rootScope","$state","$log","SessionService","eventDataService",function(e,t,o,r,n,s){e.session=n,e.eventId=t.$stateParams.eventId,"_new"===e.eventId?e.event={starts:"",eventName:"",placeName:"",organizer:"",organizerUrl:"",smartum:!1}:s.getEvent(e.eventId).then(function(t){e.event=t.data},function(e){r.error(e),toastr.error(e.error.code+" "+e.error.error),o.go("events")}),e.save=function(){s.updateItem(e.event).then(function(e){r.info("Saved Event %o",e),toastr.success("Event saved"),o.go("events")},function(e){r.error("Error saving Event %o",e),toastr.error(e.error.code+" "+e.error.error),o.go("events")})},e.cancel=function(){r.info("Cancelled Edit"),toastr.warning("Edit cancelled"),o.go("events")}}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("EventListController",["$scope","$rootScope","$state","$log","$modal","SessionService","eventDataService",function(e,t,o,r,n,s,a){function i(){t.busy(!0),a.getEvents().then(function(o){e.events=o.data.results,t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})}var l=null;e.session=s,e.totalItems=0,e.currentItem=null,i(),e.onAddClick=function(){o.go("eventedit",{eventId:"_new"})},e.onEditClick=function(e){o.go("eventedit",{eventId:e.objectId})},e.onDeleteClick=function(t){e.currentItem=t,l=n({scope:e,template:"app/tmplVerify.html",show:!0,title:"Delete Event?",content:"You are about to delete event <em>"+t.eventName+"/"+t.placeName+"</em>"})},e.dlgVerifyCancel=function(){l.hide(),toastr.warning("Delete cancelled")},e.dlgVerifyOK=function(){l.hide(),t.busy(!0),a.deleteItem(e.currentItem).then(function(){r.info("Deleted Event"),toastr.success("Event deleted"),e.events=_.filter(e.events,function(t){return t.objectId!==e.currentItem.objectId}),t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})}}])}(angular.module("app"));var angular=angular||null;!function(e){"use strict";e.module("app").factory("eventDataService",["$log","$q","$http","SessionService",function(e,t,o,r){var n="https://api.parse.com/1/classes/Event",s={};return s.getEvent=function(e){var t={isArray:!1,method:"GET",url:n+"/"+e};return o(t)},s.getEvents=function(){var e={isArray:!1,method:"GET",url:n+"?count=1&limit=1000&order=starts"};return o(e)},s.updateItem=function(e){var t=void 0===e.objectId,s=t?n+"/":n+"/"+e.objectId,a={headers:{"X-Parse-Session-Token":r.sessionToken},method:t?"POST":"PUT",url:s,data:e};return o(a)},s.deleteItem=function(e){var t=n+"/"+e.objectId,s={headers:{"X-Parse-Session-Token":r.sessionToken},method:"DELETE",url:t};return o(s)},s}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e,t){"use strict";e.controller("movieEditController",["$scope","$rootScope","$state","$log","SessionService","movieDataService",function(e,o,r,n,s,a){e.session=s,e.movieId=o.$stateParams.movieId,"_new"===e.movieId?e.movie={seenAt:{__type:"Date",iso:(new Date).toISOString()},etitle:"",otitle:"",pic:"",rating:0,url:"",synopsis:"",comment:""}:a.getItem(e.movieId).then(function(t){e.movie=t.data},function(e){n.error(e),t.error(e.error.code+" "+e.error.error),r.go("movies")}),e.save=function(){a.updateItem(e.movie).then(function(e){n.info("Saved Movie %o",e),t.success("Movie saved"),r.go("movies")},function(e){n.error("Error saving Movie %o",e),t.error(e.error.code+" "+e.error.error),r.go("movies")})},e.cancel=function(){n.info("Cancelled Edit"),t.warning("Edit cancelled"),r.go("movies")}}])}(angular.module("app"),toastr);var angular=angular||null,toastr=toastr||null;!function(e){"use strict";e.controller("movieListController",["$scope","$rootScope","$modal","$log","$state","SessionService","movieDataService",function(e,t,o,r,n,s,a){function i(){e.fetching||(e.fetching=!0,t.busy(!0),a.getPage(e.order,e.filter,e.currentPage).then(function(o){e.items=e.items.concat(o.data.results),e.totalItems=o.data.count,t.busy(!1),e.fetching=!1},function(o){t.busy(!1),r.error(o),toastr.error(o.error.code+" "+o.error.error),e.fetching=!1}))}var l=null;e.session=s,e.filter="",e.currentPage=1,e.maxSize=10,e.order="-seenAt",e.totalItems=0,e.currentItem=null,e.items=[],e.fetching=!1,i(),e.onAddClick=function(){n.go("movieedit",{movieId:"_new"})},e.onEditClick=function(e){n.go("movieedit",{movieId:e.objectId})},e.onDeleteClick=function(t){e.currentItem=t,l=o({scope:e,template:"app/tmplVerify.html",show:!0,title:"Delete Movie?",content:"You are about to delete movie <em>"+t.etitle+"</em>"})},e.dlgVerifyCancel=function(){l.hide(),toastr.warning("Delete cancelled")},e.dlgVerifyOK=function(){l.hide(),t.busy(!0),a.deleteItem(e.currentItem).then(function(){r.info("Deleted Movie"),toastr.success("Movie deleted"),e.items=_.filter(e.items,function(t){return t.objectId!==e.currentItem.objectId}),t.busy(!1)},function(e){t.busy(!1),r.error(e),toastr.error(e.error.code+" "+e.error.error)})},e.scroll=function(){e.currentPage+=1,i()}}])}(angular.module("app"));var angular=angular||null;!function(e){"use strict";e.factory("movieDataService",["$log","$q","$http","SessionService",function(e,t,o,r){var n="https://api.parse.com/1/classes/Movie",s={};return s.pageSize=100,s.getItem=function(e){var t={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"/"+e};return o(t)},s.getItems=function(){var e={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"?count=1&limit=1000&order=-seenAt"};return o(e)},s.getPage=function(e,t,a){var i=""===t?"":'&where={"'+e+'":{"$gte":"'+t+'"}}',l=(a-1)*s.pageSize,c="?count=1&limit="+s.pageSize+"&skip="+l+"&order="+e+i,u={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+c};return o(u)},s.updateItem=function(e){var t=void 0===e.objectId,s=t?n+"/":n+"/"+e.objectId,a={headers:{"X-Parse-Session-Token":r.sessionToken},method:t?"POST":"PUT",url:s,data:e};return o(a)},s.deleteItem=function(e){var t=n+"/"+e.objectId,s={headers:{"X-Parse-Session-Token":r.sessionToken},method:"DELETE",url:t};return o(s)},s}])}(angular.module("app")),function(e){"use strict";e.module("app").controller("postDeleteController",["$scope","$modalInstance","post",function(e,t,o){e.post=o,e.ok=function(){t.close("OK")},e.cancel=function(){t.dismiss("Cancel")}}])}(angular);var angular=angular||null,marked=marked||null,toastr=toastr||null;!function(e,t,o){"use strict";e.module("app").controller("PostDetailController",["$scope","$rootScope","$stateParams","$http","$sce","$log","PostDataService",function(e,r,n,s,a,i,l){function c(r){s.get("/dropbox/"+r.get("slug")).then(function(o){e.markdown=a.trustAsHtml(t(o.data))},function(e){i.error(e),o.error(e.error.code+" "+e.error.error)})}r.busy(!0),n.id&&l.getPost(n.id).then(function(t){e.title=t.get("title"),c(t),r.busy(!1)},function(e){r.busy(!1),i.error(e),o.error(e.error.code+" "+e.error.error)})}])}(angular,marked,toastr),function(e){"use strict";e.module("app").controller("postEditController",["$scope","$modalInstance","post",function(e,t,o){e.post=o,e.ok=function(){t.close("OK")},e.cancel=function(){t.dismiss("Cancel")}}])}(angular);var angular=angular||null,toastr=toastr||null;!function(e,t){"use strict";e.module("app").controller("postListController",["$scope","$rootScope","$log","$modal","PostDataService",function(e,o,r,n,s){o.busy(!0),s.getPosts().then(function(t){r.info(t),e.posts=t.data.results,o.busy(!1)},function(e){o.busy(!1),r.error(e),t.error(e.error.code+" "+e.error.error)}),e.onAddClick=function(){var e=new s.PostModel,o=n.open({templateUrl:"app/posts/edit.html",controller:"postEditController",resolve:{post:function(){return e}}});o.result.then(function(){e.save(null,{success:function(){t.success("Post added")},error:function(e,o){t.error(o.description)}})},function(){r.info("Cancel"),t.warning("Edit cancelled")})},e.onEditClick=function(e){var o={slug:e.get("slug"),title:e.get("title"),excerpt:e.get("excerpt"),tags:e.get("tags"),published:e.get("published"),publishDate:e.get("publishDate")},s=n.open({templateUrl:"app/posts/edit.html",controller:"postEditController",resolve:{post:function(){return o}}});s.result.then(function(){o.save({success:function(){t.success("Post updated")},error:function(e,o){t.error(o.description)}})},function(){r.info("Cancel"),t.warning("Edit cancelled")})},e.onDeleteClick=function(e){r.info("Deleting post %o",e);var o=e,s=n.open({templateUrl:"app/posts/delete.html",controller:"postDeleteController",resolve:{post:function(){return o}}});s.result.then(function(){o.destroy({success:function(){t.success("Post deleted")},error:function(){}})},function(){r.info("Cancel"),t.warning("Delete cancelled")})}}])}(angular,toastr);var angular=angular||null;!function(e){"use strict";e.factory("PostDataService",["$log","$q","$http","SessionService",function(e,t,o,r){var n="https://api.parse.com/1/classes/Post",s={};return s.getPost=function(e){var t={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+"/"+e};return o(t)},s.getPosts=function(){var e={headers:{"X-Parse-Session-Token":r.sessionToken},isArray:!1,method:"GET",url:n+'?where={"published":true}&count=1&limit=1000&order=-publishDate'};return o(e)},s.deletePost=function(e){var t={headers:{"X-Parse-Session-Token":r.sessionToken},method:"DELETE",url:n+"/"+e.objectId};return o(t)},s}])}(angular.module("app"));